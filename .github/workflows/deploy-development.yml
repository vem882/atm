name: dev-oracle

on:
  push:
    branches:
      - backend

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # 3. Lähetetään uudet tiedostot palvelimelle ja kasataan dev-ympäristössä. 
      # siirytään kansioon /var/www/development, johon haetaan repositorysta uusin backend-haara.
      # käynistetään pm2-palvelin uudelleen.
      - name: Deploy to Development
        run: |
            rsync -av --delete ~/actions-runner/_work/atm/atm/backend/ /var/www/development/atm/backend/ || exit
            /var/www/development/atm/backend || exit
            npm install
            cd /var/www/development/atm/backend/bin || exit
            pm2 stop www || true
            pm2 start www
